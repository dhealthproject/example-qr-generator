/**
 * This file is part of dHealth dApps Framework shared under LGPL-3.0
 * Copyright (C) 2022-present dHealth Network, All rights reserved.
 *
 * @package     dHealth dApps Framework
 * @subpackage  Examples
 * @author      dHealth Network <devs@dhealth.foundation>
 * @license     LGPL-3.0
 */
class Storage{constructor(t,e={}){this.namespace=t,this.options=e;const s=localStorage.getItem(this.namespace);null===s?(this.born=!0,this.data={networkName:this.options.networkName,networkType:this.options.networkType,networkId:this.options.generationHash,networkEpoch:this.options.epochAdjustment,activeNodeId:this.options.nodeId,createdAt:(new Date).valueOf(),collections:{}},this.persist()):this.data=JSON.parse(s),this.collections=Object.keys(this.data.collections)}persist(){this.data.updatedAt=(new Date).valueOf(),localStorage.setItem(this.namespace,JSON.stringify(this.data))}sync(){this.data=JSON.parse(localStorage.getItem(this.namespace))}metadata(t,e=null){return this.sync(),null===e&&t in this.data?this.data[t]:null===e?null:(this.data[t]=e,this.persist(),this.data[t])}dict(t){return this.sync(),t in this.data.collections?this.data.collections[t].data:{}}collect(t){const e=this.dict(t);return Object.keys(e).map((e=>this.data.collections[t].data[e]))}count(t){const e=this.dict(t);return Object.keys(e).length}push(t,e,s={pk:"id"}){if(!(s.pk in e))throw Error("Missing primary key value.");t in this.data.collections||(this.data.collections[t]={primaryKey:s.pk,data:{}});const i=e[s.pk];return this.data.collections[t].data[i]=e,this.persist(),Object.keys(this.data.collections[t].data).length}get(t,e){const s=this.dict(t);if(!(e in s))throw Error("Item not found with primary key: "+e);return s[e]}findByKey(t,e,s){return this.collect(t).filter((t=>t[e]===s))}mergeWithRequest(t,e,s={pk:"id"}){const i=this.dict(t);e=(e=this.collect(t).concat(e)).map((t=>(i.hasOwnProperty(t[s.pk])&&(t=Object.assign({},t,i[t[s.pk]])),t)));const a=new Set;return e.filter((t=>!a.has(t.publicKey)&&(a.add(t.publicKey),!0)))}}window.YourDLT=Object.assign({},window.YourDLT??{},{Storage:Storage});
/**
 * This file is part of dHealth dApps Framework shared under LGPL-3.0
 * Copyright (C) 2022-present dHealth Network, All rights reserved.
 *
 * @package     dHealth dApps Framework
 * @subpackage  Examples
 * @author      dHealth Network <devs@dhealth.foundation>
 * @license     LGPL-3.0
 */
class Repository{static getNodeHealth(e){return e.createNodeRepository().getNodeHealth()}static getNodeInfo(e){return e.createNodeRepository().getNodeInfo()}static getNodeStorage(e){return e.createNodeRepository().getStorageInfo()}static getChainInfo(e){return e.createChainRepository().getChainInfo().subscribe((e=>{console.log("chain info: ",e)}))}static getNodesInfo(e){return e.createNodeRepository().getNodePeers()}static getChainStorage(e,t=null){return e.createNodeRepository().getStorageInfo().subscribe((e=>console.log("storage info: ",e)))}static getUnlockedAccounts(e){return e.createNodeRepository().getUnlockedAccount()}}window.YourDLT=Object.assign({},window.YourDLT??{},{Repository:Repository});
/**
 * This file is part of dHealth dApps Framework shared under LGPL-3.0
 * Copyright (C) 2022-present dHealth Network, All rights reserved.
 *
 * @package     dHealth dApps Framework
 * @subpackage  Examples
 * @author      dHealth Network <devs@dhealth.foundation>
 * @license     LGPL-3.0
 */
class View{static mutateDOM(e,t=null,l=null){const s=Object.keys(e);for(let o=0,i=s.length;o<i;o++){const i=document.getElementById(s[o]);if(i.innerHTML=e[s[o]],null!==t&&t.length){null!==l&&i.classList.toggle(l);let e=t;"string"!=typeof t?(t.map((e=>i.classList.toggle(e))),e=t.join(" ")):i.classList.toggle(t),setTimeout((()=>i.classList.value.replace(e,"")),3e3)}}}static toggleModal(e){let t=document.querySelector(e),l=document.querySelectorAll(e+" .modal-close");if(t.classList.toggle("opacity-0"),t.classList.toggle("pointer-events-none"),-1<t.classList.value.indexOf("opacity-0"))return!1;for(let t=0,s=l.length;t<s;t++)l[t].addEventListener("click",(t=>{t.preventDefault(),View.toggleModal(e)}))}static toggleTooltip(e){document.querySelector(e).classList.toggle("hidden")}}window.YourDLT=Object.assign({},window.YourDLT??{},{View:View});
/**
 * This file is part of dHealth dApps Framework shared under LGPL-3.0
 * Copyright (C) 2022-present dHealth Network, All rights reserved.
 *
 * @package     dHealth dApps Framework
 * @subpackage  Examples
 * @author      dHealth Network <devs@dhealth.foundation>
 * @license     LGPL-3.0
 */
const getDappByName=e=>"dHealthTechChats"===e?"NDEVUP43ATEX2BM6XDFKVELVGQF66HOTZTIMJ6I":"dHealthClaimPool"===e?"NDEVOV2ZC22WWO5TZ6HKG7VVCFMW5EIXRW2DMMY":"NDEVUP43ATEX2BM6XDFKVELVGQF66HOTZTIMJ6I",getNoteByInput=e=>e.length?e:"I claim that I wish to receive dHealth's NFT",getTransactionRequest=(e,t,a)=>"claim"===e?_SDK.TransferTransaction.create(_SDK.Deadline.create(_CTRL.options.network.epochAdjustment),_SDK.Address.createFromRawAddress(getDappByName(t)),[new _SDK.Mosaic(new _SDK.MosaicId("39E0C49FA322A459"),_SDK.UInt64.fromUint(0))],_SDK.PlainMessage.create(a),_SDK.NetworkType.MAIN_NET,_SDK.UInt64.fromUint(0)):_SDK.TransferTransaction.create(_SDK.Deadline.create(_CTRL.options.network.epochAdjustment),_SDK.Address.createFromRawAddress(getDappByName(t)),[new _SDK.Mosaic(new _SDK.MosaicId("39E0C49FA322A459"),_SDK.UInt64.fromUint(0))],_SDK.PlainMessage.create("I am testing dHealth Network."),_SDK.NetworkType.MAIN_NET,_SDK.UInt64.fromUint(0)),createTransactionQR=()=>{let e=document.getElementById("type-selector").value,t=document.getElementById("dapp-selector").value,a=document.getElementById("message-input").value,n=getTransactionRequest(e,t,a),r=_QRLIB.QRCodeGenerator.createTransactionRequest(n,_SDK.NetworkType.MAIN_NET,_CTRL.options.network.generationHash),o=document.querySelector('[id="qr-code-wrapper"]'),s=document.createElement("img");r.toBase64().toPromise().then((e=>{s.setAttribute("src",e)})),o.appendChild(s)};window.YourDLT=Object.assign({},window.YourDLT??{},{createTransactionQR:createTransactionQR});
/**
 * This file is part of dHealth dApps Framework shared under LGPL-3.0
 * Copyright (C) 2022-present dHealth Network, All rights reserved.
 *
 * @package     dHealth dApps Framework
 * @subpackage  Examples
 * @author      dHealth Network <devs@dhealth.foundation>
 * @license     LGPL-3.0
 */
const _SDK=require("/node_modules/dhealth-sdk"),_QRLIB=require("/node_modules/dhealth-qr-library");let _STORE=null,_NODES=null,_NODE=null,_CTRL=null;
/**
 * @class YourDLT.Controller
 * @package YourDLT
 * @description The controller class controls the repository and view.
 * @author Gregory Saive for Using Blockchain Ltd <greg@ubc.digital>
 * @license AGPL-3.0
 * @link https://yourdlt.tools
 */class Controller{constructor(t,e={}){this.network={networkType:e.networkType??_SDK.NetworkType.MAIN_NET,generationHash:e.generationHash??"ED5761EA890A096C50D3F50B7C2F0CCB4B84AFC9EA870F381E84DDE36D04EF16",epochAdjustment:e.epochAdjustment??1616978397},this.options=Object.assign({},e,{network:this.network}),this.namespace=e.namespace??"yourdlt/ninja",this._NODE_URL=t,this._WS_URL=t.replace(/^https?:\/\//,"ws://")+"/ws",this._HOST=t.replace(/^https?:\/\//,"").replace(":3000",""),this._ADAPTER=new _SDK.RepositoryFactoryHttp(this._NODE_URL,{...this.network,websocketUrl:this._WS_URL,websocketInjected:WebSocket,nodePublicKey:e.nodePublicKey??null}),_STORE=new Storage(this.namespace,this.network),_NODES=_STORE.birth?{[this.options.identityPublicKey]:{publicKey:this.options.identityPublicKey,nodePublicKey:this.options.nodePublicKey,host:this._HOST,port:7900}}:_STORE.dict("nodes"),_CTRL=this}async connect(){const t=await Repository.getNodeInfo(this._ADAPTER).toPromise();t.host.length||(t.host=this._HOST),_NODE=t.publicKey,_NODES[_NODE]=t,_STORE.push("nodes",t,{pk:"publicKey"}),Repository.getChainInfo(this._ADAPTER)}}const readNetwork=(t,e={})=>(controller=new Controller(t,e),controller.connect()),setupUI=()=>{let t=document.querySelectorAll("[data-toggle]");for(let e=0,o=t.length;e<o;e++)t[e].addEventListener("click",(t=>{t.preventDefault(),createTransactionQR();let e=t.target.getAttribute("data-toggle");View.toggleModal(e)}));let e=document.querySelectorAll("[data-tooltip]");for(let t=0,o=e.length;t<o;t++)e[t].addEventListener("click",(t=>{t.preventDefault();let e=t.target.getAttribute("data-tooltip");View.toggleTooltip(e)}))};window.YourDLT={readNetwork:readNetwork,setupUI:setupUI};
